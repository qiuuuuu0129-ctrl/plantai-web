{% extends "base.html" %}
{% block content %}
<h1>è®¾å¤‡æ§åˆ¶ä¸­å¿ƒ</h1>

<style>
  section.card {
    border: 1px solid #ddd;
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 20px;
    box-shadow: 0 1px 5px rgba(0,0,0,0.1);
  }
  button {
    margin-top: 8px;
    margin-right: 5px;
    padding: 8px 14px;
    border-radius: 6px;
  }
  button.secondary {
    background: #ccc;
    color: #333;
  }
  #ctrlResult {
    background: #f8f9fa;
    padding: 12px;
    border-radius: 10px;
    margin-top: 15px;
  }
</style>

<section class="card">
  <h3>ğŸ’§ æ°´æ³µ</h3>
  <label>æ—¶é•¿ï¼ˆç§’ï¼‰ï¼š
    <input type="number" id="pumpDur" value="3" min="1" max="30">
  </label>
  <div>
    <button onclick="sendControl({pump:true, pump_duration:Number($('#pumpDur').value)})">å¼€å¯</button>
    <button class="secondary" onclick="sendControl({pump:false})">å…³é—­</button>
  </div>
</section>

<section class="card">
  <h3>ğŸ’¡ è¡¥å…‰ç¯</h3>
  <label>äº®åº¦ï¼ˆ%ï¼‰ï¼š
    <input type="number" id="lightBri" value="70" min="0" max="100">
  </label>
  <div>
    <button onclick="sendControl({light:true, brightness:Number($('#lightBri').value)})">å¼€å¯</button>
    <button class="secondary" onclick="sendControl({light:false})">å…³é—­</button>
  </div>
</section>

<section class="card">
  <h3>ğŸŒˆ WS2812 å…‰è°±ç¯</h3>
  <label>æ¨¡å¼ï¼š
    <select id="wsMode">
      <option value="white">ç™½</option>
      <option value="red">çº¢</option>
      <option value="green">ç»¿</option>
      <option value="blue">è“</option>
      <option value="yellow">é»„</option>
      <option value="purple">ç´«</option>
    </select>
  </label>
  <label>äº®åº¦ï¼ˆ0-255ï¼‰ï¼š
    <input type="number" id="wsBri" value="128" min="0" max="255">
  </label>
  <label>æ—¶é•¿ï¼ˆç§’ï¼‰ï¼š
    <input type="number" id="wsDur" value="10" min="1" max="60">
  </label>
  <div>
    <button onclick="sendControl({
      ws_enable:true,
      ws_mode:$('#wsMode').value,
      ws_brightness:Number($('#wsBri').value),
      ws_duration:Number($('#wsDur').value)
    })">è®¾ç½®å¹¶å¼€å¯</button>
    <button class="secondary" onclick="sendControl({ws_enable:false})">å…³é—­ WS</button>
  </div>
</section>

<section id="ctrlResult"><b>çŠ¶æ€ï¼š</b>æ— </section>

<script>
function $(id){return document.querySelector(id);}
async function sendControl(payload){
  $('#ctrlResult').innerHTML = "â³ æ‰§è¡Œä¸­...";
  try{
    const res = await fetch("/api/control", {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify(payload)
    });
    const data = await res.json();
    if(data.ok){
      $('#ctrlResult').innerHTML = "<b>âœ… æˆåŠŸï¼š</b>" + JSON.stringify(data.status);
    }else{
      $('#ctrlResult').innerHTML = "<b>âŒ å¤±è´¥ï¼š</b>" + data.error;
    }
  }catch(e){
    $('#ctrlResult').innerHTML = "<b>âš ï¸ ç½‘ç»œé”™è¯¯ï¼š</b>" + e;
  }
}
</script>

{% endblock %}
